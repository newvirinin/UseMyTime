{% extends "base.html" %}
{% block title %}Очередь проектов на проверку{% endblock %}
{% block content %}
<h1>Очередь проектов на проверку</h1>
<table class="table align-middle">
  <thead>
    <tr>
      <th>#</th>
      <th>Проект</th>
      <th>Описание</th>
      <th>Отправлен</th>
      <th class="text-end">Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for project in object_list %}
    <tr>
      <td>{{ forloop.counter }}</td>
      <td><a href="{% url 'project_detail' project.pk %}">{{ project.title }}</a></td>
      <td class="text-truncate" style="max-width: 420px;">{{ project.description }}</td>
      <td>
        {{ project.review_submitted_at|date:"d.m.Y H:i" }}
        {% if project.review_submitted_by %}<div class="small text-muted">{{ project.review_submitted_by.get_full_name|default:project.review_submitted_by.username }}</div>{% endif %}
      </td>
      <td class="text-end">
        {% with role=user.profile.role|default:'' %}
        {% if role == 'manager' or role == 'sector_manager' %}
          <form method="post" action="{% url 'project_review_approve' project.pk %}" class="d-inline">
            {% csrf_token %}
            <button class="btn btn-success btn-sm">Принять</button>
          </form>
          <form method="post" action="{% url 'project_review_reject' project.pk %}" class="d-inline ms-2">
            {% csrf_token %}
            <input type="text" name="review_comment" class="form-control d-inline-block me-2" style="width:220px" placeholder="Комментарий" />
            <button class="btn btn-danger btn-sm">Вернуть</button>
          </form>
        {% endif %}
        {% endwith %}
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="5" class="text-center">Нет проектов на проверке</td></tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
